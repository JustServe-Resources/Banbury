import{i as e,a as n,r as s,j as t,F as a,L as r,S as o,H as l,I as i,M as c,u,b as d,N as m,T as p,C as h,s as j,c as f,d as b,e as g,f as x,g as v,O as y,h as w,k,l as C,p as q,n as _,o as S,q as T,P as I,A as F,t as P,v as R,w as $,D as L,x as E,K as D,y as M,z as V,B as z,E as A,G as N,J as G,$ as U,Q as H,R as O,U as X,V as B,W,X as Y,Y as J,Z as K,_ as Z,a0 as Q,a1 as ee,a2 as ne,a3 as se,a4 as te}from"shared";import{F as ae,M as re,T as oe,c as le}from"ThemeProviders";function ie(e){try{const n=window.sessionStorage.getItem(ae),s=n?JSON.parse(n):[];s.push(e),window.sessionStorage.setItem(ae,JSON.stringify(s))}catch(e){console.error("Cannot add flash notification",e)}}function ce({field:e,onChange:n}){const{label:s,error:u,value:d,name:m,required:p,description:h,type:j}=e,f={},b="integer"===j||"decimal"===j?"number":"text";"integer"===j&&(f.step="1"),"decimal"===j&&(f.step="any");const g="anonymous_requester_email"===j?"email":void 0;return t.jsxs(a,{children:[t.jsxs(r,{children:[s,p&&t.jsx(o,{"aria-hidden":"true",children:"*"})]}),h&&t.jsx(l,{dangerouslySetInnerHTML:{__html:h}}),t.jsx(i,{name:m,type:b,defaultValue:d,validation:u?"error":void 0,required:p,onChange:e=>{n&&n(e.target.value)},autoComplete:g,...f}),u&&t.jsx(c,{validation:"error",children:u})]})}const ue=j(a)`
  .ck.ck-editor {
    margin-top: ${e=>e.theme.space.xs};
  }
`,de=j(c)`
  .ck.ck-editor + & {
    margin-top: ${e=>e.theme.space.xs};
  }
`;function me({field:e,hasWysiwyg:n,baseLocale:a,hasAtMentions:i,userRole:c,brandId:j,onChange:b}){const{label:g,error:x,value:v,name:y,required:w,description:k}=e,C=function({hasWysiwyg:e,baseLocale:n,hasAtMentions:a,userRole:r,brandId:o}){const l=s.useRef(!1),{addToast:i}=u(),{t:c}=d();return s.useCallback((async s=>{if(e&&s&&!l.current){l.current=!0;const{createEditor:e}=await import("shared").then((function(e){return e.m}));(await e(s,{editorType:"supportRequests",hasAtMentions:a,userRole:r,brandId:o,baseLocale:n})).plugins.get("Notification").on("show",((e,n)=>{e.stop();const s=n.message instanceof Error?n.message.message:n.message,{type:a,title:r}=n;i((({close:e})=>t.jsxs(m,{type:a,children:[t.jsx(p,{children:r}),s,t.jsx(h,{"aria-label":c("new-request-form.close-label","Close"),onClick:e})]})))}))}}),[e,n,a,r,o,i,c])}({hasWysiwyg:n,baseLocale:a,hasAtMentions:i,userRole:c,brandId:j});return t.jsxs(ue,{children:[t.jsxs(r,{children:[g,w&&t.jsx(o,{"aria-hidden":"true",children:"*"})]}),k&&t.jsx(l,{dangerouslySetInnerHTML:{__html:k}}),t.jsx(f,{ref:C,name:y,defaultValue:v,validation:x?"error":void 0,required:w,onChange:e=>b(e.target.value),rows:6,isResizable:!0}),x&&t.jsx(de,{validation:"error",children:x})]})}function pe(){const{t:e}=d();return t.jsxs(t.Fragment,{children:[t.jsx(o,{"aria-hidden":"true",children:"-"}),t.jsx(o,{hidden:!0,children:e("new-request-form.dropdown.empty-option","Select an option")})]})}function he({field:e,onChange:n}){const{label:a,options:r,error:l,value:i,name:c,required:u,description:d}=e,m=null==i?"":i.toString(),p=s.useRef(null);return s.useEffect((()=>{if(p.current&&u){const e=p.current.querySelector("[role=combobox]");e?.setAttribute("aria-required","true")}}),[p,u]),t.jsxs(b,{children:[t.jsxs(g,{children:[a,u&&t.jsx(o,{"aria-hidden":"true",children:"*"})]}),d&&t.jsx(x,{dangerouslySetInnerHTML:{__html:d}}),t.jsxs(v,{ref:p,inputProps:{name:c,required:u},isEditable:!1,validation:l?"error":void 0,inputValue:m,selectionValue:m,renderValue:({selection:e})=>e?.label||t.jsx(pe,{}),onChange:({selectionValue:e})=>{void 0!==e&&n(e)},children:[!u&&t.jsx(y,{value:"",label:"-",children:t.jsx(pe,{})}),r.map((e=>t.jsx(y,{value:e.value.toString(),label:e.name},e.value)))]}),l&&t.jsx(w,{validation:"error",children:l})]})}function je({field:e,onChange:n}){const{label:i,error:u,value:d,name:m,required:p,description:h}=e,[j,f]=s.useState(d);return t.jsxs(a,{children:[t.jsx("input",{type:"hidden",name:m,value:"off"}),t.jsxs(k,{name:m,required:p,defaultChecked:d,value:j?"on":"off",onChange:e=>{const{checked:s}=e.target;f(s),n(s)},children:[t.jsxs(r,{children:[i,p&&t.jsx(o,{"aria-hidden":"true",children:"*"})]}),h&&t.jsx(l,{dangerouslySetInnerHTML:{__html:h}})]}),u&&t.jsx(c,{validation:"error",children:u})]})}const fe="[]";function be(e){return`[${e.join("::")}]`}function ge(e){return e.startsWith("[")&&e.endsWith("]")}function xe(e){const n=be(e.slice(0,-1));return{type:"SubGroup",name:e[e.length-1],backOption:{type:"previous",label:"Back",value:n},options:[]}}function ve({options:e,hasEmptyOption:n}){const t=s.useMemo((()=>function(e,n){const s={[fe]:{type:"RootGroup",options:n?[{label:"-",value:""}]:[]}};return e.forEach((e=>{const{name:n,value:t}=e;if(n.includes("::")){const[e,a]=function(e){const n=e.split("::");return[n.slice(0,-1),n.slice(-1)[0]]}(n),r=be(e);s[r]||(s[r]=xe(e)),s[r]?.options.push({value:t,label:n.split("::").join(" > "),menuLabel:a});for(let n=0;n<e.length;n++){const t=e.slice(0,n),a=e.slice(0,n+1),r=be(t),o=be(a);s[r]||(s[r]=xe(t)),void 0===s[r]?.options.find((e=>e.value===o))&&s[r]?.options.push({type:"next",label:a[a.length-1],value:o})}}else s[fe].options.push({value:t,label:n})})),s}(e,n)),[e,n]),[a,r]=s.useState(function(e){const n={type:"RootGroup",options:[]};return Object.values(e).forEach((({options:e})=>{n.options.push(...e.filter((({type:e})=>void 0===e)))})),n}(t));s.useEffect((()=>{r(t[fe])}),[t]);return{currentGroup:a,isGroupIdentifier:ge,setCurrentGroupByIdentifier:e=>{const n=t[e];n&&r(n)}}}function ye({field:e}){const{label:n,options:a,error:r,value:l,name:i,required:c,description:u}=e,{currentGroup:d,isGroupIdentifier:m,setCurrentGroupByIdentifier:p}=ve({options:a,hasEmptyOption:!1}),[h,j]=s.useState(l||[]),f=s.useRef(null);s.useEffect((()=>{if(f.current&&c){const e=f.current.querySelector("[role=combobox]");e?.setAttribute("aria-required","true")}}),[f,c]);return t.jsxs(b,{children:[h.map((e=>t.jsx("input",{type:"hidden",name:`${i}[]`,value:e},e))),t.jsxs(g,{children:[n,c&&t.jsx(o,{"aria-hidden":"true",children:"*"})]}),u&&t.jsx(x,{dangerouslySetInnerHTML:{__html:u}}),t.jsxs(v,{ref:f,isMultiselectable:!0,inputProps:{required:c},isEditable:!1,validation:r?"error":void 0,onChange:e=>{if(Array.isArray(e.selectionValue)){const n=e.selectionValue.slice(-1).toString();m(n)?p(n):j(e.selectionValue)}},selectionValue:h,maxHeight:"auto",children:["SubGroup"===d.type&&t.jsx(y,{...d.backOption}),"SubGroup"===d.type?t.jsx(C,{"aria-label":d.name,children:d.options.map((e=>t.jsx(y,{...e,children:e.menuLabel??e.label},e.value)))}):d.options.map((e=>t.jsx(y,{...e},e.value)))]}),r&&t.jsx(w,{validation:"error",children:r})]})}const we="return-focus-to-ticket-form-field";function ke({field:e,newRequestPath:n}){const a=s.createRef();return s.useEffect((()=>{sessionStorage.getItem(we)&&(sessionStorage.removeItem(we),a.current?.firstChild?.focus())}),[]),t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"hidden",name:e.name,value:e.value}),e.options.length>1&&t.jsxs(b,{children:[t.jsx(g,{children:e.label}),t.jsx(v,{isEditable:!1,onChange:({selectionValue:e})=>{if(e&&"number"==typeof e){const s=new URL(window.location.href);s.searchParams.set("ticket_form_id",e),sessionStorage.setItem(we,"true"),window.location.assign(`${n}${s.search}`)}},ref:a,children:e.options.map((n=>t.jsx(y,{value:n.value,label:n.name,isSelected:e.value===n.value,children:n.name},n.value)))})]})]})}function Ce({field:e}){const{value:n,name:s}=e;return t.jsx("input",{type:"hidden",name:s,value:n})}function qe(e){const n=s.useRef(!1),t=s.useRef(!1);return{formRefCallback:s.useCallback((s=>{s&&!n.current&&(n.current=!0,s.submit=async()=>{if(!1===t.current){t.current=!0;const n=await async function(){const e=await fetch("/api/v2/help_center/sessions.json"),{current_session:n}=await e.json();return n.csrf_token}(),a=document.createElement("input");a.type="hidden",a.name="authenticity_token",a.value=n,s.appendChild(a);const r=e.filter((e=>"partialcreditcard"===e.type));for(const e of r){const n=s.querySelector(`input[name="${e.name}"]`);n&&n instanceof HTMLInputElement&&4===n.value.length&&(n.value=`XXXXXXXXX${n.value}`)}HTMLFormElement.prototype.submit.call(s)}})}),[e]),handleSubmit:e=>{e.preventDefault(),e.target.submit()}}}const _e=2048,Se="tf_",Te=/^\d{4}-\d{2}-\d{2}$/,Ie=["true","false"],Fe=["pre","strong","b","p","blockquote","ul","ol","li","h2","h3","h4","i","em","br"];function Pe(e,n){if(!Number.isNaN(Number(e))){const s=`request[custom_fields][${e}]`;return n.ticketFields.find((e=>e.name===s))}switch(e){case"anonymous_requester_email":return n.emailField;case"due_at":return n.dueDateField;case"collaborators":return n.ccField;case"organization_id":return n.organizationField;default:return n.ticketFields.find((n=>n.name===`request[${e}]`))}}function Re(e){if(!Te.test(e))return!1;const n=new Date(e),[s,t,a]=e.split("-").map(Number);return n.getUTCFullYear()===s&&n.getUTCMonth()+1===t&&n.getUTCDate()===a}function $e({ticketFields:e,ccField:n,dueDateField:t,emailField:a,organizationField:r}){return s.useMemo((()=>function(e){const{href:n}=location,s=new URL(n).searchParams,t={...e,ticketFields:[...e.ticketFields]};if(n.length>_e)return e;if(s.get("parent_id"))return e;for(const[e,n]of s){if(!e.startsWith(Se))continue;const s=Pe(e.substring(Se.length),t);if(!s)continue;const a=q.sanitize(n,{ALLOWED_TAGS:Fe});switch(s.type){case"partialcreditcard":continue;case"multiselect":s.value=a.split(",").filter((e=>s.options.some((n=>n.value===e))));break;case"checkbox":Ie.includes(a)&&(s.value="true"===a?"on":"false"===a?"off":"");break;case"due_at":case"date":Re(a)&&(s.value=a);break;default:s.value=a}}return t}({ticketFields:e,ccField:n,dueDateField:t,emailField:a,organizationField:r})),[e,n,t,a,r])}const Le=j.div`
  flex: 1;
`;function Ee({file:e,onRemove:n}){const{t:s}=d(),a=e=>{"Enter"!==e.code&&"Space"!==e.code&&"Delete"!==e.code&&"Backspace"!==e.code||(e.preventDefault(),n())},r="pending"===e.status?e.file_name:e.value.file_name,o=s("new-request-form.attachments.stop-upload","Stop upload"),l=s("new-request-form.attachments.remove-file","Remove file");return t.jsx(_.Item,{children:t.jsx(S,{type:"generic",tabIndex:0,"aria-label":s("new-request-form.attachments.file","File: {{fileName}}, press delete to remove",{fileName:r}),onKeyDown:e=>{"Delete"!==e.code&&"Backspace"!==e.code||(e.preventDefault(),n())},children:"pending"===e.status?t.jsxs(t.Fragment,{children:[t.jsx(Le,{children:r}),t.jsx(T,{content:o,children:t.jsx(S.Close,{"aria-label":s("new-request-form.attachments.stop-upload-aria-label","Stop uploading {{fileName}}",{fileName:r}),"aria-describedby":void 0,onClick:()=>{n()},onKeyDown:a})}),t.jsx(I,{value:e.progress,"aria-label":s("new-request-form.attachments.uploading","Uploading {{fileName}}",{fileName:r})})]}):t.jsxs(t.Fragment,{children:[t.jsx(Le,{children:t.jsx(F,{isExternal:!0,href:e.value.url,target:"_blank",children:r})}),t.jsx(T,{content:l,children:t.jsx(S.Delete,{"aria-label":s("new-request-form.attachments.remove-file-aria-label","Remove file: {{fileName}}",{fileName:r}),"aria-describedby":void 0,onClick:()=>{n()},onKeyDown:a})}),t.jsx(I,{value:100,"aria-hidden":"true"})]})})})}async function De(){const e=await fetch("/api/v2/users/me.json"),{user:{authenticity_token:n}}=await e.json();return n}function Me({field:e}){const{label:n,error:o,name:l,attachments:j}=e,{files:f,addPendingFile:b,setPendingFileProgress:g,setUploaded:x,removePendingFile:v,removeUploadedFile:y}=function(e){const[n,t]=s.useState(e);return{files:n,addPendingFile:s.useCallback(((e,n,s)=>{t((t=>[...t,{status:"pending",id:e,file_name:n,progress:0,xhr:s}]))}),[]),setPendingFileProgress:s.useCallback(((e,n)=>{t((s=>s.map((s=>"pending"===s.status&&s.id===e?{...s,progress:n}:s))))}),[]),removePendingFile:s.useCallback((e=>{t((n=>n.filter((n=>"pending"!==n.status||n.id!==e))))}),[]),removeUploadedFile:s.useCallback((e=>{t((n=>n.filter((n=>"uploaded"!==n.status||n.value.id!==e))))}),[]),setUploaded:s.useCallback(((e,n)=>{t((s=>s.map((s=>"pending"===s.status&&s.id===e?{status:"uploaded",value:n}:s))))}),[])}}(j.map((e=>({status:"uploaded",value:e})))??[]),{addToast:w}=u(),{t:k}=d(),C=s.useCallback((e=>{w((({close:n})=>t.jsxs(m,{type:"error",children:[t.jsx(p,{children:k("new-request-form.attachments.upload-error-title","Upload error")}),k("new-request-form.attachments.upload-error-description","There was an error uploading {{fileName}}. Try again or upload another file.",{fileName:e}),t.jsx(h,{"aria-label":k("new-request-form.close-label","Close"),onClick:n})]})))}),[w,k]),q=s.useCallback((async e=>{const n=await De();for(const s of e){const e=new XMLHttpRequest,t=new URL(`${window.location.origin}/api/v2/uploads.json`);if(t.searchParams.append("filename",s.name),e.open("POST",t),s.type)e.setRequestHeader("Content-Type",s.type);else{const n=P.getType(s.name);e.setRequestHeader("Content-Type",n||"application/octet-stream")}e.setRequestHeader("X-CSRF-Token",n),e.responseType="json";const a=crypto.randomUUID();b(a,s.name,e),e.upload.addEventListener("progress",(({loaded:e,total:n})=>{const s=Math.round(e/n*100);s<=90&&g(a,s)})),e.addEventListener("load",(()=>{if(e.status>=200&&e.status<300){const{upload:{attachment:{file_name:n,content_url:s},token:t}}=e.response;x(a,{id:t,file_name:n,url:s})}else C(s.name),v(a)})),e.addEventListener("error",(()=>{C(s.name),v(a)})),e.send(s)}}),[b,v,g,x,C]),{getRootProps:S,getInputProps:T,isDragActive:I}=R({onDrop:q});return t.jsxs(a,{children:[t.jsx(r,{children:n}),o&&t.jsx(c,{validation:"error",children:o}),t.jsxs($,{...S(),isDragging:I,children:[I?t.jsx("span",{children:k("new-request-form.attachments.drop-files-label","Drop files here")}):t.jsx("span",{children:k("new-request-form.attachments.choose-file-label","Choose a file or drag and drop here")}),t.jsx(i,{...T()})]}),t.jsx(_,{children:f.map((e=>t.jsx(Ee,{file:e,onRemove:()=>{(async e=>{if("pending"===e.status)e.xhr.abort(),v(e.id);else{const n=await De(),s=e.value.id;y(e.value.id),await fetch(`/api/v2/uploads/${s}.json`,{method:"DELETE",headers:{"X-CSRF-Token":n}})}})(e)}},"pending"===e.status?e.id:e.value.id)))}),f.map((e=>"uploaded"===e.status&&t.jsx("input",{type:"hidden",name:l,value:JSON.stringify(e.value)},e.value.id)))]})}function Ve(e,n){return n.filter((n=>n.child_fields.some((n=>n.id===e))))}function ze(e,n,s){return e.filter((e=>{const t=s.find((n=>n.id===e.parent_field_id));if(!t)return!1;const a=Ve(t.id,n);return t.value===e.value&&(0===a.length||ze(a,n,s).length>0)}))}function Ae(e,n){return 0===n.length?e:e.reduce(((s,t)=>{const a=Ve(t.id,n);if(0===a.length)return[...s,t];const r=ze(a,n,e);return r.length>0?[...s,{...t,required:r.some((e=>e.child_fields.some((e=>e.id==t.id&&e.is_required))))}]:s}),[])}function Ne({field:e,locale:n,valueFormat:u,onChange:d}){const{label:m,error:p,value:h,name:j,required:f,description:b}=e,[g,x]=s.useState(h?new Date(h):void 0),v=s.useCallback((e=>new Intl.DateTimeFormat(n,{month:"long",day:"numeric",year:"numeric",timeZone:"UTC"}).format(e)),[n]),y=s.useCallback((e=>{if(void 0===e)return"";const n=e.toISOString();return"dateTime"===u?n:n.split("T")[0]}),[u]),w=s.useCallback((e=>{const n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0));x(n);const s=y(n);void 0!==s&&d(s)}),[d,y]);return t.jsxs(a,{children:[t.jsxs(r,{children:[m,f&&t.jsx(o,{"aria-hidden":"true",children:"*"})]}),b&&t.jsx(l,{dangerouslySetInnerHTML:{__html:b}}),t.jsx(L,{value:g,onChange:w,formatDate:v,locale:n,children:t.jsx(i,{required:f,lang:n,onChange:e=>{""===e.target.value&&(x(void 0),d(""))},validation:p?"error":void 0})}),p&&t.jsx(c,{validation:"error",children:p}),t.jsx("input",{type:"hidden",name:j,value:y(g)})]})}const Ge=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,Ue=j(V)`
  padding: ${e=>`${e.theme.space.xxs} ${e.theme.space.sm}`};

  // Removes white spaces for inline elements
  font-size: 0;

  // Same as height of Tag size="large" + base space (4px)
  // to give some vertical space between tags
  --line-height: ${e=>8*e.theme.space.base+e.theme.space.base}px;
  line-height: var(--line-height);
`,He=j.span`
  display: inline-block;
  margin-right: ${e=>e.theme.space.sm};
`,Oe=j(z)`
  ${e=>M({theme:e.theme,shadowWidth:"sm",selector:"&:focus"})}
`,Xe=j.div`
  display: inline-block;
  position: relative;
`,Be=j(V)`
  display: inline-block;
  min-width: 200px;
  opacity: 0;
  user-select: none;
  height: var(--line-height);
  line-height: var(--line-height);
`,We=j(i)`
  position: absolute;
  top: 0;
  left: 0;
  height: var(--line-height);
  line-height: var(--line-height);
`;function Ye({field:e}){const{label:n,value:i,name:u,error:m,description:p}=e,{t:h}=d(),j=i?i.split(",").map((e=>e.trim())):[],[f,b]=s.useState(j),[g,x]=s.useState(""),v=s.useRef(null),y=s.useRef(null),{getContainerProps:w,getGridProps:k,getGridRowProps:C,getGridCellProps:q,getTagCloseProps:_,getInputProps:S,getAnnouncementProps:I,announcement:F}=function({tags:e,onTagsChange:n,inputValue:t,onInputValueChange:a,inputRef:r,gridRowRef:o,i18n:l}){const[i,c]=s.useState(0),[u,d]=s.useState(""),m=s.useCallback(((e,n)=>{c(n)}),[c]),{getGridProps:p,getGridCellProps:h}=E({matrix:[e],rowIndex:0,colIndex:i,onChange:m}),j=n=>e.includes(n),f=s=>{n([...e,s]),d(l.addedTag(s))},b=s=>{const t=e[s];n(e.filter(((e,n)=>n!==s))),d(l.removedTag(t)),c(0),setTimeout((()=>{const e=o.current?.querySelector('[tabindex="0"]');e?.focus()}),100)},g=e=>{e.target===e.currentTarget&&r.current?.focus()},x=()=>{c(0)},v=e=>{const n=e.target.value;!n||e.key!==D.SPACE&&e.key!==D.ENTER&&e.key!==D.TAB&&e.key!==D.COMMA||(e.preventDefault(),j(n)||f(n),a(""))},y=e=>{const n=e.target.value,[s,t]=[n.slice(0,-1),n.slice(-1)];" "===t||","===t?(s.length>0&&!j(s)&&f(s),a("")):a(n)},w=s=>{s.preventDefault();const t=s.clipboardData.getData("text"),a=new Set(t.split(/[\s,;]+/).filter((n=>!e.includes(n))));n([...e,...a]),d(l.addedTags([...a]))},k=e=>{const n=e.target.value;n&&(j(n)||f(n),a(""))},C=e=>n=>{"Backspace"===n.code&&(n.preventDefault(),b(e))},q=e=>()=>{b(e)};return{getContainerProps:()=>({onClick:g,onBlur:x,tabIndex:-1}),getGridProps:p,getGridRowProps:()=>({role:"row"}),getGridCellProps:e=>h({rowIndex:0,colIndex:e,onKeyDown:C(e)}),getTagCloseProps:e=>({onClick:q(e)}),getInputProps:()=>({value:t,onChange:y,onKeyDown:v,onPaste:w,onBlur:k}),announcement:u,getAnnouncementProps:()=>({"aria-live":"polite","aria-relevant":"text"})}}({tags:f,onTagsChange:b,inputValue:g,onInputValueChange:x,inputRef:v,gridRowRef:y,i18n:{addedTag:e=>h("new-request-form.cc-field.email-added","{{email}} has been added",{email:e}),removedTag:e=>h("new-request-form.cc-field.email-removed","{{email}} has been removed",{email:e}),addedTags:e=>h("new-request-form.cc-field.emails-added","{{emails}} have been added",{emails:e})}}),P=(e,n,s)=>t.jsxs(Oe,{size:"large","aria-label":h("new-request-form.cc-field.email-label","{{email}} - Press Backspace to remove",{email:s}),hue:n?void 0:"red",children:[!n&&t.jsx(z.Avatar,{children:t.jsx(A,{})}),t.jsx("span",{children:s}),t.jsx(z.Close,{..._(e)})]});return t.jsxs(a,{children:[t.jsx(r,{children:n}),p&&t.jsx(l,{children:p}),t.jsxs(Ue,{...w(),children:[f.length>0&&t.jsx("span",{...k({"aria-label":h("new-request-form.cc-field.container-label","Selected CC emails")}),children:t.jsx("span",{ref:y,...C(),children:f.map(((e,n)=>{const s=Ge.test(e);return s?t.jsx(He,{...q(n),children:P(n,s,e)},n):t.jsx(T,{content:h("new-request-form.cc-field.invalid-email","Invalid email address"),children:t.jsx(He,{...q(n),children:P(n,s,e)})},n)}))})}),t.jsxs(Xe,{children:[t.jsx(Be,{isBare:!0,"aria-hidden":"true",tabIndex:-1,children:g}),t.jsx(We,{ref:v,isBare:!0,...S()})]})]}),m&&t.jsx(c,{validation:"error",children:m}),f.map((e=>t.jsx("input",{type:"hidden",name:u,value:e},e))),t.jsx(o,{hidden:!0,...I(),children:F})]})}const Je=j(o)`
  margin-left: ${e=>e.theme.space.xxs};
  font-weight: ${e=>e.theme.fontWeights.medium};
`;function Ke({field:e,onChange:n}){const{t:s}=d(),{label:i,error:u,value:m,name:p,required:h,description:j}=e,f=function(e){return e?e.replaceAll("X",""):""}(m);return t.jsxs(a,{children:[t.jsxs(r,{children:[i,h&&t.jsx(o,{"aria-hidden":"true",children:"*"}),t.jsx(Je,{children:s("new-request-form.credit-card-digits-hint","(Last 4 digits)")})]}),j&&t.jsx(l,{dangerouslySetInnerHTML:{__html:j}}),t.jsx(N,{start:t.jsx(G,{}),name:p,type:"text",value:f,onChange:e=>n(e.target.value),validation:u?"error":void 0,required:h,maxLength:4,placeholder:"XXXX"}),u&&t.jsx(c,{validation:"error",children:u})]})}function Ze({field:e,onChange:n}){const{label:a,options:r,error:l,value:i,name:c,required:u,description:d}=e,{currentGroup:m,isGroupIdentifier:p,setCurrentGroupByIdentifier:h}=ve({options:r,hasEmptyOption:!0}),j=i??"",[f,k]=s.useState(!1),q=s.useRef(null);s.useEffect((()=>{if(q.current&&u){const e=q.current.querySelector("[role=combobox]");e?.setAttribute("aria-required","true")}}),[q,u]);return t.jsxs(b,{children:[t.jsxs(g,{children:[a,u&&t.jsx(o,{"aria-hidden":"true",children:"*"})]}),d&&t.jsx(x,{dangerouslySetInnerHTML:{__html:d}}),t.jsxs(v,{ref:q,inputProps:{required:u,name:c},isEditable:!1,validation:l?"error":void 0,onChange:e=>{"string"==typeof e.selectionValue&&p(e.selectionValue)?h(e.selectionValue):("string"==typeof e.selectionValue&&n(e.selectionValue),void 0!==e.isExpanded&&k(e.isExpanded))},selectionValue:j,inputValue:j,renderValue:({selection:e})=>e?.label??t.jsx(pe,{}),isExpanded:f,children:["SubGroup"===m.type&&t.jsx(y,{...m.backOption}),"SubGroup"===m.type?t.jsx(C,{"aria-label":m.name,children:m.options.map((e=>t.jsx(y,{...e,children:e.menuLabel??e.label},e.value)))}):m.options.map((e=>""===e.value?t.jsx(y,{...e,children:t.jsx(pe,{})},e.value):t.jsx(y,{...e},e.value)))]}),l&&t.jsx(w,{validation:"error",children:l})]})}const Qe=U`
  from {
    grid-template-rows: 0fr;
  }
  to {
    grid-template-rows: 1fr;
  }
`,en=j.div`
  display: grid;
  animation: ${Qe} 200ms forwards;
`,nn=j.div`
  overflow: hidden;
`,sn=j.ul`
  list-style: none;
  padding: 0;
  margin: 0;
`,tn=j.li`
  margin: ${e=>e.theme.space.sm} 0;
`;function an({query:e,locale:n}){const a=function(e,n){const[t,a]=s.useState(e);return s.useEffect((()=>{const s=setTimeout((()=>a(e)),n);return()=>{clearTimeout(s)}}),[e,n]),t}(e,500),[r,o]=s.useState([]),l=s.useRef({}),{t:i}=d();return s.useEffect((()=>{const e=a?.trim().toLocaleLowerCase();if(!e||!function(e){const n=e.charCodeAt(0);return n>=19968&&n<=195103?e.length>=2:e.length>=3}(e))return void o([]);const s=new URL(`${window.location.origin}/api/v2/help_center/deflection/suggestions.json`);s.searchParams.append("locale",n),s.searchParams.append("query",e);const t=l.current[s.toString()];t?o(t):fetch(s).then((e=>e.json())).then((({results:e})=>{l.current[s.toString()]=e,o(e)}))}),[a,n]),r.length>0?t.jsx(en,{"data-test-id":"suggested-articles",children:t.jsxs(nn,{children:[t.jsx("h2",{children:i("new-request-form.suggested-articles","Suggested articles")}),t.jsx(sn,{children:r.map((e=>t.jsx(tn,{children:t.jsx(F,{href:e.html_url,children:e.name})},e.html_url)))})]})}):null}const rn=j.h3`
  font-size: ${e=>e.theme.fontSizes.md};
  font-weight: ${e=>e.theme.fontWeights.bold};
`,on=j(O)`
  color: ${e=>H("successHue",700,e.theme)};
`,ln=j(X)`
  position: absolute;
  top: ${e=>5.5*e.theme.space.base}px;
  inset-inline-start: ${e=>4*e.theme.space.base+"px"};
`,cn=j(F)`
  display: inline-block;
  margin-top: ${e=>e.theme.space.sm};
`;function un({authToken:e,interactionAccessToken:n,articles:a,requestId:r,hasRequestManagement:o,isSignedIn:l,helpCenterPath:i,requestsPath:c,requestPath:u}){const[m,p]=s.useState(0),h=function(){const e=s.useContext(re);if(null===e)throw new Error("useModalContainer should be used inside a ModalContainerProvider");return e}(),{t:j}=d(),f=()=>String(a[m]?.article_id),b=()=>{ie({type:"success",message:j("new-request-form.answer-bot-modal.request-submitted","Your request was successfully submitted")}),window.location.assign((()=>{if(l)return o?u:i;{const e=new URLSearchParams;return e.set("return_to",c),`${i}?${e.toString()}`}})())};return t.jsxs(B,{appendToNode:h,onClose:()=>{b()},children:[t.jsxs(on,{tag:"h2",children:[t.jsx(ln,{}),j("new-request-form.answer-bot-modal.request-submitted","Your request was successfully submitted")]}),t.jsxs(W,{children:[t.jsx(rn,{children:j("new-request-form.answer-bot-modal.title","While you wait, do any of these articles answer your question?")}),t.jsx("p",{children:j("new-request-form.answer-bot-modal.footer-content","If it does, we can close your recent request {{requestId}}",{requestId:`‭#${r}‬`})}),t.jsx(Y,{level:4,expandedSections:[m],onChange:e=>{p(e)},children:a.map((({article_id:n,html_url:s,snippet:a,title:r})=>t.jsxs(Y.Section,{children:[t.jsx(Y.Header,{children:t.jsx(Y.Label,{children:r})}),t.jsxs(Y.Panel,{children:[t.jsx(J,{dangerouslySetInnerHTML:{__html:a}}),t.jsx(cn,{isExternal:!0,href:`${s}?auth_token=${e}`,target:"_blank",children:j("new-request-form.answer-bot-modal.view-article","View article")})]})]},n)))})]}),t.jsxs(K,{children:[t.jsx(Z,{children:t.jsx(Q,{onClick:()=>{(async()=>{await fetch("/api/v2/answer_bot/rejection",{method:"POST",body:JSON.stringify({article_id:f(),interaction_access_token:n,reason_id:0}),headers:{"Content-Type":"application/json"}}),b()})()},children:j("new-request-form.answer-bot-modal.mark-irrelevant","No, I need help")})}),t.jsx(Z,{children:t.jsx(Q,{isPrimary:!0,onClick:()=>{(async()=>{(await fetch("/api/v2/answer_bot/resolution",{method:"POST",body:JSON.stringify({article_id:f(),interaction_access_token:n}),headers:{"Content-Type":"application/json"}})).ok?ie({type:"success",message:j("new-request-form.answer-bot-modal.request-closed","Nice. Your request has been closed.")}):ie({type:"error",message:j("new-request-form.answer-bot-modal.solve-error","There was an error closing your request")}),window.location.href=i})()},children:j("new-request-form.answer-bot-modal.solve-request","Yes, close my request")})})]}),t.jsx(ee,{"aria-label":j("new-request-form.close-label","Close")})]})}const dn={value:"",name:"-"};function mn({field:e,userId:n,organizationId:a,onChange:r}){const{id:l,label:i,error:c,value:u,name:m,required:p,description:h,relationship_target_type:j}=e,[f,k]=s.useState([]),[C,q]=s.useState(null),[_,S]=s.useState(u),[T,I]=s.useState(!1),{t:F}=d(),P=j.replace("zen:custom_object:","");const R={name:F("new-request-form.lookup-field.loading-options","Loading items..."),id:"loading"},$={name:F("new-request-form.lookup-field.no-matches-found","No matches found"),id:"no-results"},L=s.useCallback((async e=>{try{const n=await fetch(`/api/v2/custom_objects/${P}/records/${e}`);if(n.ok){const{custom_object_record:e}=await n.json(),s={name:e.name,value:e.id};q(s),S(e.name)}}catch(e){console.error(e)}}),[P]),E=s.useCallback((async e=>{const s=new URLSearchParams;s.set("name",e.toLocaleLowerCase()),s.set("source","zen:ticket"),s.set("field_id",l.toString()),s.set("requester_id",n.toString()),null!==a&&s.set("organization_id",a),I(!0);try{const e=await fetch(`/api/v2/custom_objects/${P}/records/autocomplete?${s.toString()}`),n=await e.json();if(e.ok){let e=n.custom_object_records.map((({name:e,id:n})=>({name:e,value:n})));C&&(e=e.filter((e=>e.value!==C.value)),e=[C,...e]),k(e)}else k([])}catch(e){console.error(e)}finally{I(!1)}}),[P,l,a,C,n]),D=s.useMemo((()=>ne(E,300)),[E]);s.useEffect((()=>()=>D.cancel()),[D]);const M=s.useCallback((({inputValue:e,selectionValue:n})=>{if(void 0!==n)if(""==n)q(dn),S(dn.name),k([]),r(dn.value);else{const e=f.find((e=>e.value===n));e&&(S(e.name),q(e),k([e]),r(e.value))}void 0!==e&&(S(e),D(e))}),[D,r,f]);s.useEffect((()=>{u&&L(u)}),[]);return t.jsxs(b,{children:[t.jsxs(g,{children:[i,p&&t.jsx(o,{"aria-hidden":"true",children:"*"})]}),h&&t.jsx(x,{dangerouslySetInnerHTML:{__html:h}}),t.jsxs(v,{inputProps:{required:p},"data-test-id":"lookup-field-combobox",validation:c?"error":void 0,inputValue:_,selectionValue:C?.value,isAutocomplete:!0,placeholder:F("new-request-form.lookup-field.placeholder","Search {{label}}",{label:i.toLowerCase()}),onFocus:()=>{S(""),E("*")},onChange:M,renderValue:()=>C?C?.name:dn.name,children:[C?.name!==dn.name&&t.jsx(y,{value:"",label:"-",children:t.jsx(pe,{})}),T&&t.jsx(y,{isDisabled:!0,value:R.name},R.id),!T&&_?.length>0&&0===f.length&&t.jsx(y,{isDisabled:!0,value:$.name},$.id),!T&&0!==f.length&&f.map((e=>t.jsx(y,{value:e.value,label:e.name,"data-test-id":`option-${e.name}`},e.value)))]}),c&&t.jsx(w,{validation:"error",children:c}),t.jsx("input",{type:"hidden",name:m,value:C?.value})]})}const pn=j(J)`
  margin: ${e=>e.theme.space.md} 0;
`,hn=j.form`
  display: flex;
  flex-direction: column;
  gap: ${e=>e.theme.space.md};
`,jn=j.div`
  margin-top: ${e=>e.theme.space.md};
`;function fn({requestForm:e,wysiwyg:n,newRequestPath:a,parentId:r,parentIdPath:o,locale:l,baseLocale:i,hasAtMentions:c,userRole:u,userId:m,brandId:p,organizations:h,answerBotModal:j}){const{ticket_fields:f,action:b,http_method:g,accept_charset:x,errors:v,parent_id_field:y,ticket_form_field:w,email_field:k,cc_field:C,organization_field:q,due_date_field:_,end_user_conditions:S,attachments_field:T,inline_attachments_fields:I,description_mimetype_field:P}=e,{answerBot:R}=j,{ticketFields:$,emailField:L,ccField:E,organizationField:D,dueDateField:M}=$e({ticketFields:f,emailField:k,ccField:C,organizationField:q,dueDateField:_}),[V,z]=s.useState($),[A,N]=s.useState(D),[G,U]=s.useState(M),H=Ae(V,S),{formRefCallback:O,handleSubmit:X}=qe(V),{t:B}=d(),W=h.length>0&&h[0]?.id?h[0]?.id?.toString():null,Y=s.useCallback(((e,n)=>{z(V.map((s=>s.name===e.name?{...s,value:n}:s)))}),[V]);const J=s.useCallback((e=>{null!==G&&U({...G,value:e})}),[G]);return t.jsxs(t.Fragment,{children:[r&&t.jsx(pn,{children:t.jsx(F,{href:o,children:B("new-request-form.parent-request-link","Follow-up to request {{parentId}}",{parentId:`‭#${r}‬`})})}),t.jsx(pn,{"aria-hidden":"true",children:B("new-request-form.required-fields-info","Fields marked with an asterisk (*) are required.")}),t.jsxs(hn,{ref:O,action:b,method:g,acceptCharset:x,noValidate:!0,onSubmit:X,children:[v&&t.jsx(se,{type:"error",children:v}),y&&t.jsx(Ce,{field:y}),w.options.length>0&&t.jsx(ke,{field:w,newRequestPath:a}),L&&t.jsx(ce,{field:L},L.name),E&&t.jsx(Ye,{field:E}),A&&t.jsx(he,{field:A,onChange:e=>{!function(e){null!==A&&N({...A,value:e})}(e)}},A.name),H.map((e=>{switch(e.type){case"subject":return t.jsxs(t.Fragment,{children:[t.jsx(ce,{field:e,onChange:n=>Y(e,n)},e.name),t.jsx(an,{query:e.value,locale:l})]});case"text":case"integer":case"decimal":case"regexp":return t.jsx(ce,{field:e,onChange:n=>Y(e,n)},e.name);case"partialcreditcard":return t.jsx(Ke,{field:e,onChange:n=>Y(e,n)});case"description":return t.jsxs(t.Fragment,{children:[t.jsx(me,{field:e,hasWysiwyg:n,baseLocale:i,hasAtMentions:c,userRole:u,brandId:p,onChange:n=>Y(e,n)},e.name),t.jsx("input",{type:"hidden",name:P.name,value:n?"text/html":"text/plain"})]});case"textarea":return t.jsx(me,{field:e,hasWysiwyg:!1,baseLocale:i,hasAtMentions:c,userRole:u,brandId:p,onChange:n=>Y(e,n)},e.name);case"priority":case"basic_priority":case"tickettype":return t.jsxs(t.Fragment,{children:[t.jsx(he,{field:e,onChange:n=>Y(e,n)},e.name),"task"===e.value&&t.jsx(Ne,{field:G,locale:i,valueFormat:"dateTime",onChange:e=>{J(e)}})]});case"checkbox":return t.jsx(je,{field:e,onChange:n=>Y(e,n)});case"date":return t.jsx(Ne,{field:e,locale:i,valueFormat:"date",onChange:n=>Y(e,n)});case"multiselect":return t.jsx(ye,{field:e});case"tagger":return t.jsx(Ze,{field:e,onChange:n=>Y(e,n)},e.name);case"lookup":return t.jsx(mn,{field:e,userId:m,organizationId:null!==A?A.value:W,onChange:n=>Y(e,n)},e.name);default:return t.jsx(t.Fragment,{})}})),T&&t.jsx(Me,{field:T}),I.map((({type:e,name:n,value:s},a)=>t.jsx("input",{type:e,name:n,value:s},a))),t.jsx(jn,{children:(0===w.options.length||w.value)&&t.jsx(Q,{isPrimary:!0,type:"submit",children:B("new-request-form.submit","Submit")})})]}),R.auth_token&&R.interaction_access_token&&R.articles.length>0&&R.request_id&&t.jsx(un,{authToken:R.auth_token,interactionAccessToken:R.interaction_access_token,articles:R.articles,requestId:R.request_id,...j})]})}async function bn(s,a,r){const{baseLocale:o}=a;var l;l=o,e.use(n).init({resources:{[`${l}`]:{}},lng:l,lowerCaseLng:!0,interpolation:{escapeValue:!1},keySeparator:!1,pluralSeparator:"."}),await async function(n,s){try{const{default:t}=await s();e.addResourceBundle(n,"translation",t)}catch(e){console.error(`Cannot load translations for ${n}`)}}(o,(()=>function(e){switch(e){case"./translations/locales/af.json":return import("af");case"./translations/locales/ar-x-pseudo.json":return import("ar-x-pseudo");case"./translations/locales/ar.json":return import("ar");case"./translations/locales/az.json":return import("az");case"./translations/locales/be.json":return import("be");case"./translations/locales/bg.json":return import("bg");case"./translations/locales/bn.json":return import("bn");case"./translations/locales/bs.json":return import("bs");case"./translations/locales/ca.json":return import("ca");case"./translations/locales/cs.json":return import("cs");case"./translations/locales/cy.json":return import("cy");case"./translations/locales/da.json":return import("da");case"./translations/locales/de-de.json":return import("de-de");case"./translations/locales/de-x-informal.json":return import("de-x-informal");case"./translations/locales/de.json":return import("de");case"./translations/locales/el.json":return import("el");case"./translations/locales/en-001.json":return import("en-001");case"./translations/locales/en-150.json":return import("en-150");case"./translations/locales/en-au.json":return import("en-au");case"./translations/locales/en-ca.json":return import("en-ca");case"./translations/locales/en-gb.json":return import("en-gb");case"./translations/locales/en-my.json":return import("en-my");case"./translations/locales/en-ph.json":return import("en-ph");case"./translations/locales/en-se.json":return import("en-se");case"./translations/locales/en-us.json":return import("en-us");case"./translations/locales/en-x-dev.json":return import("en-x-dev");case"./translations/locales/en-x-keys.json":return import("en-x-keys");case"./translations/locales/en-x-obsolete.json":return import("en-x-obsolete");case"./translations/locales/en-x-pseudo.json":return import("en-x-pseudo");case"./translations/locales/en-x-test.json":return import("en-x-test");case"./translations/locales/es-419.json":return import("es-419");case"./translations/locales/es-es.json":return import("es-es");case"./translations/locales/es.json":return import("es");case"./translations/locales/et.json":return import("et");case"./translations/locales/eu.json":return import("eu");case"./translations/locales/fa-af.json":return import("fa-af");case"./translations/locales/fa.json":return import("fa");case"./translations/locales/fi.json":return import("fi");case"./translations/locales/fil.json":return import("fil");case"./translations/locales/fo.json":return import("fo");case"./translations/locales/fr-ca.json":return import("fr-ca");case"./translations/locales/fr.json":return import("fr");case"./translations/locales/ga.json":return import("ga");case"./translations/locales/he.json":return import("he");case"./translations/locales/hi.json":return import("hi");case"./translations/locales/hr.json":return import("hr");case"./translations/locales/hu.json":return import("hu");case"./translations/locales/hy.json":return import("hy");case"./translations/locales/id.json":return import("id");case"./translations/locales/is.json":return import("is");case"./translations/locales/it-ch.json":return import("it-ch");case"./translations/locales/it.json":return import("it");case"./translations/locales/ja.json":return import("ja");case"./translations/locales/ka.json":return import("ka");case"./translations/locales/kk.json":return import("kk");case"./translations/locales/kl-dk.json":return import("kl-dk");case"./translations/locales/ko.json":return import("ko");case"./translations/locales/ku.json":return import("ku");case"./translations/locales/lt.json":return import("lt");case"./translations/locales/lv.json":return import("lv");case"./translations/locales/mk.json":return import("mk");case"./translations/locales/mn.json":return import("mn");case"./translations/locales/ms.json":return import("ms");case"./translations/locales/mt.json":return import("mt");case"./translations/locales/my.json":return import("my");case"./translations/locales/nl-be.json":return import("nl-be");case"./translations/locales/nl.json":return import("nl");case"./translations/locales/no.json":return import("no");case"./translations/locales/pl.json":return import("pl");case"./translations/locales/pt-br.json":return import("pt-br");case"./translations/locales/pt.json":return import("pt");case"./translations/locales/ro.json":return import("ro");case"./translations/locales/ru.json":return import("ru");case"./translations/locales/sk.json":return import("sk");case"./translations/locales/sl.json":return import("sl");case"./translations/locales/sq.json":return import("sq");case"./translations/locales/sr-me.json":return import("sr-me");case"./translations/locales/sr.json":return import("sr");case"./translations/locales/sv.json":return import("sv");case"./translations/locales/th.json":return import("th");case"./translations/locales/tr.json":return import("tr");case"./translations/locales/uk.json":return import("uk");case"./translations/locales/ur.json":return import("ur");case"./translations/locales/uz.json":return import("uz");case"./translations/locales/vi.json":return import("vi");case"./translations/locales/zh-cn.json":return import("zh-cn");case"./translations/locales/zh-tw.json":return import("zh-tw");default:return new Promise((function(n,s){("function"==typeof queueMicrotask?queueMicrotask:setTimeout)(s.bind(null,new Error("Unknown variable dynamic import: "+e)))}))}}(`./translations/locales/${o}.json`))),te.render(t.jsx(oe,{theme:le(s),children:t.jsx(fn,{...a})}),r)}export{bn as renderNewRequestForm};
